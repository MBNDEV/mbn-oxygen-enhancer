document.addEventListener('DOMContentLoaded', function () {
  var videos = document.querySelectorAll('video');
  videos.forEach(function(video) {
    var hasDataSrc = video.hasAttribute('data-src');
    if (hasDataSrc) {
      video.setAttribute('src', video.getAttribute('data-src'));
      //video.removeAttribute('data-src');
    }
    // Handle <source> tags inside video
    var sources = video.querySelectorAll('source[data-src]');
    sources.forEach(function(source) {
      source.setAttribute('src', source.getAttribute('data-src'));
      //source.removeAttribute('data-src');
    });
    // After setting src(s), force reload
    if (hasDataSrc || sources.length > 0) {
      video.load();
    }
    // Play if autoplay attribute is present
    if (video.hasAttribute('autoplay')) {
      // Try to play, catch promise if required
      var playPromise = video.play();
      if (playPromise && typeof playPromise.then === 'function') {
        playPromise.catch(function(e){
          // Playback was prevented
        });
      }
    }
  });
});
